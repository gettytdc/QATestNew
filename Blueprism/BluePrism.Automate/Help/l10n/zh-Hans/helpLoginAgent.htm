<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link type="text/css" href="AutomateHelp.css" rel="stylesheet" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>登录代理</title>
    <script type="text/javascript" src="script/imagezoom.js"></script>
    <style type="text/css">
        h3, h4 {
            clear: left !important;
        }

        span.filter {
            color: #666;
            font-weight: bold;
        }

        div.section-screenshot, div.screenshot {
            width: 100px;
        }

        ul.nobullets li, dl.nobullets dt {
            list-style-type: none;
        }
    </style>
</head>

<body class="slick">
    <div class="header">
        <h1 class="pagetitle">登录代理</h1>
    </div>
    <div class="captioned-image overview-screenshot nozoom">
        <a href="Graphics/control-room-with-login-agent-resources.png" title="控制室：显示了登录代理运行时资源">
            <img src="Graphics/control-room-with-login-agent-resources.png" alt="控制室：显示了登录代理运行时资源"/>
        </a>
    </div>
    <p>Blue Prism 中的登录代理组件提供了一种可在 Windows 设备上执行安全日志的机制，以扩展 Blue Prism 运行时资源的功能。</p>
    <p>登录代理实际上允许运行时资源：</p>
    <ul>
        <li>先接收指令再使设备登录 Windows（例如，当设备处于预先登录状态时）</li>
        <li>向操作系统发送授权信息并使用本地或网络凭据登录设备</li>
        <li>执行其他操作，如密码重置</li>
    </ul>
    <p>登录代理会创建并配置一个 Windows 服务，以使其负责启动能够与操作系统通信以实现 Windows 登录的专用登录代理运行时资源。</p>
    
    <p>登录代理运行时资源会以专用图标的形式出现在控制室中。</p>
    
    <p>经过适当配置后，只要计算机处于预先登录状态，登录代理运行时资源就会启动，并在登录设备并启动常规 Blue Prism 运行时资源之前一直保持活动状态。启动 Blue Prism 运行时资源会使登录代理 运行时资源自动关闭。</p>
    <div class="Highlighted" style="background-color: lightgrey" ><p><font color="black"> 登录代理运行时资源会通过仅有有限访问权限的帐户来运行，而且没有本地计算机的完整访问权限。因此，它只能用于实现登录操作。</font> 
</p></div>  
<h2>安装登录代理</h2>   
    <h3>先决条件</h3>
    <p>Windows Desktop 操作系统：XP、Vista、7、8.1、10（32 位和 64 位）</p>
    <p>Windows Server 操作系统：2008、2008 R2、2012、2012 R2（32 位和 64 位）</p>
    <p>安装登录代理需要使用管理员访问权限。</p>
    <p>请务必为目标设备应用以下安全策略。</p> 
  
    <ul>
        <li>在用户名和密码字段显示前，不得要求按 ctrl + alt + del</li>
        <li>在登录过程中，不得要求遍历屏幕消息（例如使用接受策略）</li>
        <li>不得要求遍历锁定屏幕（Windows 8.1 和 Windows 10）</li>
    </ul>
    <p>安装登录代理时，这些策略会覆盖设备上的本地策略；但是，在企业网络中，可能需要对策略进行集中更改。</p>

    <h3>安装登录代理</h3>
    <div class="captioned-image overview-screenshot">
        <img src="Graphics/login-agent-installer-connection-name.png" alt="选择 Blue Prism 连接名称"/>
    </div> <p>登录代理的安装程序可以在 Blue Prism 安装目录中找到。请务必选择与目标设备的 CPU 架构相匹配的安装文件。</p>
    <p>对于 32 位操作系统，请选择<code> [Blue Prism 位置]\Installers\LoginAgent_x86.msi</code></p>
    <p>对于 64 位操作系统，请选择<code> [Blue Prism 位置]\Installers\LoginAgent_x64.msi</code></p>
 <p>在安装过程中需要提供连接名称，这个名称必须精确匹配本地设备上现有 Blue Prism 连接的名称。</p>   
    <p>列有设备上当前已配置连接的列表可以在 Blue Prism 客户端上找到（如图所示）</p>
    
<h3>登录代理示例流程和业务对象</h3>   
  <p>在所需设备上部署好登录代理后，可以将登录代理发行包（登录代理安装目录中的 <code>Login Agent Release.bprelease</code>）导入到环境中。这可通过在任意一个设备上使用“文件”-&gt;“导入”菜单项来实现。数据已复制到数据库中，因此只需为每个相关 Blue Prism 环境完成一次此操作即可。</p>   

<p>在所提供的示例流程中，有两个流程（“登录”和“更改密码”）需要为每个设备都创建相应的凭据记录。这些凭据记录需使用以下默认命名格式来创建：<code>Windows Login:[计算机名称]</code>。例如，如果通过端口 8190 在 robot0001 上配置运行时资源，则默认凭据名称应为 <code>Windows Login: robot0001</code>。</p>
    <p>这个 VBO 提供了一组示例操作，可用于针对操作系统完成常规身份验证操作，如“登录”、“已登录”、“注销”、“更改密码”。</p>
    <p>有关登录代理 VBO 及其操作的信息，请参阅“帮助”&gt;“API 文档”下的 API 文档。</p>
    <div class="Highlighted" style="background-color:lightgrey">
        <p><font color="black">在覆盖现有版本的登录代理 VBO 时，需要重新验证使用所提供功能的任何流程。</font>  </p></div>

    <h2>高级主题</h2>
    <h3>更新或自定义登录代理配置</h3>
    <p>负责初始化登录代理运行时资源的 Blue Prism 登录代理服务的配置存储在本地配置文件中：</p>
    <p><code>C:\ProgramData\Blue Prism Limited\Automate V3\LoginAgentService.config</code></p>
    <p><code>workingdirectory</code> 元素指向 Blue Prism 软件的安装目录。</p>
    <div class="captioned-image section-screenshot">
        <img src="Graphics/login-agent-config.png" alt="配置登录代理"/>
    </div><p><code>startuparguments</code> 元素提供了启动登录代理运行时资源时所使用的参数。例如，可以配置这个部分，以更新运行时资源将要侦听的端口，或更新用于连接环境的连接的名称。</p>
        
    
        <h3>已配置为使用基于证书的加密方式的资源</h3>
        <p>
            <div class="captioned-image section-screenshot  ">
                <img src="Graphics/login-agent-config-2.png" alt="配置为使用基于证书的加密方式"/>
            </div>

            <div class="captioned-image section-screenshot   ">
                <img src="Graphics/login-agent-config-3.png" alt="配置为使用基于证书的加密方式"/>
            </div>如果将常规运行时资源配置为使用指定证书强制加密传入连接（例如，使用 /sslcert 开关启动运行时时），则需要手动对登录代理运行时资源应用适当的配置。</p>

        <p>可以更新配置文件中的 <code>startuparguments</code> 元素以包含适当的信息：</p>
       
    <h3>静默安装</h3>
    <p>静默安装可通过使用 msiexec 来实现。请务必针对 CPU 架构选择正确的安装程序（例如：对于 32 位操作系统，请选择 x86；对于 64 位操作系统，请选择 x64）。</p>
    <p>您需要提供以下参数：</p>
    <ul>
        <li><b>[Blue Prism 安装位置]</b>，即已将 Blue Prism 安装到的目标位置。这通常就是登录代理安装文件所在的位置</li>
        <li><b>[连接名称]</b>，必须精确匹配本地设备上现有 Blue Prism 连接的名称。列有设备上当前已配置连接的列表可以在 Blue Prism 客户端上找到。</li>
    </ul>
    <p>例如：</p>
    <p><code>msiexec /i &quot;[Blue Blue 安装位置]\Installers\LoginAgent_x86.msi &quot; /quiet BPCONN=&quot;[连接名称]&quot; </code></p>
    <p>例如：</p>
    <p><code>msiexec /i &quot;c:\Program Files\Blue Prism Limited\Blue Prism Automate\Installers\LoginAgent_x86.msi &quot; /quiet BPCONN=&quot;Prod:Financial Services&quot;</code></p>

    <h3>配置日志</h3>
   
    <p>您可以通过配置相应的注册表项设置，将登录代理配置为在特定设备上生成诊断日志。</p>
    <p>对于适当版本的登录代理，可以在注册表中的以下位置找到这些注册表项：</p>
    <p><code>HKEY_LOCAL_MACHINE\SOFTWARE\Blue Prism Limited\LoginAgent</code></p>
    <ul>
        <li><b>LogFileDir</b>：指定日志文件的生成位置。</li>
        <li><b>LogLevel</b>：指定日志的详细程度级别。0：禁用（默认）；1：错误消息；2：调试消息；4：跟踪消息。要组合使用几个级别，可以将这些值相加。例如，值 7 表示将提供错误消息、调试消息和跟踪消息。</li>
    </ul>
    <div class="Highlighted" style="background-color:lightgrey">
        <p><font color="Black"> 建议仅在故障排除时使用日志记录。必须重启设备才能应用注册表设置更改。 </font>
        </p>
    </div>
</body>
</html>
