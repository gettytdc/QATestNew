<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link type="text/css" href="AutomateHelp.css" rel="stylesheet" />
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<title>活动队列</title>
	<script type="text/javascript" src="script/imagezoom.js"></script>
	<style type="text/css">
	</style>
</head>

<body class="slick">
	<div class="header">
		<h1 class="pagetitle">流程功能</h1>
		<h2>活动队列</h2>
	</div>

	<div class="captioned-image overview-screenshot nozoom">
		<a href="Graphics/active-queues.png" title="活动队列—点击查看大图"><img alt="活动队列—点击查看大图" src="Graphics/active-queues.png"/></a>
		<p>活动队列</p>
	</div>

	<h3 id="overview">概述</h3>

    <p>在 Blue Prism 产品中可以使用<a href="helpQueues.htm">工作队列</a>，以便在会话中按预定义的顺序进行案例排队和处理。</p>

    <p>通过使用传统的会话管理模式，在轮询工作队列以处理案例的资源中启动会话。这些会话在控制室中手动启动，或者通过在 <a href="helpScheduler.htm">Blue Prism 服务器</a>实例上运行的<a href="helpBPServer.htm">调度程序</a>服务启动。</p>

    <p>活动队列引入了替代机制来管理负责处理队列的会话，这是通过在工作队列与会话之间创建更紧密的关联来实现的。</p>

    <p>活动队列允许您设置应处理队列的资源的目标数量，而不是在控制室中单独创建会话，然后转到队列管理页面来查看结果。Blue Prism 使用活动队列配置来确定如何实现该目标。</p>

    <h3 id="queue-requirements">活动队列要求</h3>

    <p>为使 Blue Prism 确定如何代表队列开始和停止会话，需要了解有关队列的两项信息：</p>

    <ul>
      <li>哪些流程将处理队列？</li>
      <li>应使用哪些资源处理队列？</li>
    </ul>

    <p>可在 Blue Prism 客户端的“系统”<code></code>部分中的<a href="sysman-queues.html">工作队列配置</a>页面上设置这些信息，方法是将已发布的流程和资源组与队列相关联。</p>

    <p>借助这些信息，Blue Prism 可找到可用资源并在其中创建流程，然后通过该流程来处理队列。</p>

    <p>为了代表活动队列停止正在运行的会话，应向会话发出“停止请求”，这可确保会话不会在事务进行期间停止。如需了解更多详细信息，请查看<a href="#process-requirements">流程要求</a>。</p>

    <h3 id="process-requirements">流程要求</h3>

    <p>为了代表活动队列工作，流程必须满足一些基本要求。</p>

    <ul>
      <li>必须先发布流程，然后才可将其设置为活动队列中的已分配流程。</li>

      <li><p>假设流程包含一个主循环，在该循环中必须使用决策环节来查询函数 <code>IsStopRequested()</code>，以确认是否已请求安全停止。</p>
          <p>活动队列控制器将使用该机制代表其控制的活动队列来停止正在运行的会话。</p></li>
    </ul>

     <h3 id="how-it-works">工作方式</h3>
     <p>进入控制室的“活动队列”<code></code>部分时，系统为显示的每个队列创建一个<code>活动队列控制器</code>。用户从客户端注销之前，这些控制器将保留在内存中。</p>

     <p>每个控制器监视在分配给其队列的资源上运行的会话，并轮询数据库以获得其负责的队列的最新统计信息。</p>

     <p>设置目标资源值后，控制器将确定是否需要创建新会话或停止现有会话以达到该目标。如果需要新会话，它将创建并启动新会话；如果必须停止现有会话，它将向适当数量的会话发送停止请求以达到目标值。</p>

     <h4>创建新会话</h4>
     <p>如果队列控制器确定必须创建新会话才能到达目标，它将在分配给其队列的资源组中的可用资源上创建和启动新会话。</p>

     <p>它将首先在最不繁忙的资源上创建会话。例如，如果该组有三个可用资源，并且其中两个正在运行后台流程，则它创建的第一个会话将位于未运行任何会话的资源上。</p>

     <p>如果由于某种原因无法创建或启动任何会话，它将在其他资源上重试。尝试三次后，它将放弃会话并递减目标值，以指示它将不再尝试创建会话。</p>

     <p>如果发生导致会话被控制器放弃的任何错误，该错误将被记录在 Blue Prism 事件日志中，并且将在 Windows 事件查看器中可见。</p>

     <h4>停止现有会话</h4>
     <p>如果队列控制器决定必须停止现有会话才能达到目标，则它将遍历会话并选择最早的会话（即最早启动的会话）以向其发送停止请求。</p>

     <p>当控制器向会话发送停止请求时，该会话将被标记为<code>正在停止</code>。在这种状态下，它仍在“运行”，即它仍然计入队列中的“活动会话”数量，并且无法在其上运行更多会话。</p>

     <p>为了正确停止，工作进程必须定期检查 <code>IsStopRequested()</code> 函数，清理其环境并在该函数指示已请求停止时退出流程。</p>

     <h4>会话完成/终止</h4>
     <p>代表活动队列运行的会话完成或终止时，它将不再计入队列的“活动会话”数量，并重新可用于更多会话。</p>

     <p>如果会话在队列控制器发送停止请求之后完成/终止，则目标资源值不变（即会话按预期停止以便达到目标值）。</p>

     <p>如果会话在队列控制器发送任何停止请求之前完成/终止，则目标资源值递减（即未创建其他会话来取代它）。</p>

     <h3 id="pools">活动队列和资源池</h3>

     <p>一定程度上，<a href="helpResourcePools.htm">资源池</a>会尝试解决与活动队列中分配的资源组相同的问题，即查找可用资源并在其上执行流程。</p>

     <p>因此，建议不要在活动队列中使用资源池—活动队列控制器假定每个资源均表示一个用于代表其队列运行会话的槽位。资源池是透明的，因为它们看起来是可以运行多个排他性会话的单个资源，并且队列控制器无法深入查看成员资源以确定可用性。</p>

     <p>如果确实在分配给活动队列的资源组中包含一个资源池，则它将被视为“可用资源”计数中的单个资源，并且只会为其分配一个会话，且此时该队列不会将其考虑在内。</p>


</body>
</html>
