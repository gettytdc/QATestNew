<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link type="text/css" href="AutomateHelp.css" rel="stylesheet"/>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<title>Blue Prismコレクション</title>
</head>

<body>
	<div class="header">
		<h1 class="pagetitle">ヘルプ</h1>
	</div>

	<h2>コレクション - 概要</h2>

	<p>コレクションは、複数のデータアイテムを1つにまとめたものです。通常、コレクションは、ビジネスオブジェクトから多数の異なる情報を1回のトランザクションで取得するために使用されます。情報が取り込まれたら、<a href="frmStagePropertiesLoopStart.htm">ループステージ</a>を使用してコレクション内の情報にシーケンシャルにアクセスできます。</p>

	<p>コレクションのコンテンツは、行と列を含むテーブルとして考えると便利です。列は<em class="buzzword">フィールド</em>と呼ばれます。フィールドの名前は、ユーザーによって指定されるか、対応するビジネスオブジェクト内で定義されます。</p>
	
	<p>フィールドは、式内で「ドット」構文（「コレクション名.フィールド名」）を使用してアクセスします。<i>例：</i>「Person」というステージで定義されているコレクション内の「Name」フィールドの場合は、<a href="frmStagePropertiesCalculation.htm">計算ステージ</a>または<a href="frmStagePropertiesDecision.htm">決定ステージ</a> で参照（<code>[Person.Name]</code>）を使用してアクセスできます。</p>
	
	<p>フィールド名に角括弧やドットを含めることはできません。これは参照先のコレクションの構造とフィールド名が衝突しないようにするためです。</p>

	<h3>定義済みと未定義</h3>
	<p>フィールドの名前と<a href="helpDataTypes.htm">データ型</a>が<a href="frmStagePropertiesCollection.htm">コレクションステージのプロパティ</a>フォームで明示的に定義されている場合、コレクションは<em class="buzzword">定義済み</em>と言われます。このフィールド定義は、ユーザーによって考案される場合もあれば、コレクションが使用されるビジネスオブジェクトの設計者によって事前に決定されている場合もあります。</p>
	
	<p>同様に、フィールドがプロパティフォームで定義されていない場合、コレクションは<em class="buzzword">未定義</em>と言われます。
 このような状況は、構造が変化する可能性のあるデータを含むシステムとやり取りするときに頻繁に発生します。例として、スプレッドシートに含まれるデータ（表形式）の取得などがあります。スプレッドシート内の表の列について何も分からない場合、コレクションの列（または<em class="buzzword">フィールド</em>）にあらかじめラベルやデータ型をアタッチできません。コレクションのフィールドは実行時にのみ利用可能になります。</p>
	
	<h3 id="nested">入れ子のコレクション</h3>
	
	<p>コレクションはそれ自体にコレクションを含むことができます。これらのコレクションもまた、コレクションステージ内で<em class="buzzword">定義済み</em>になることや、データが入力されるまで<em class="buzzword">未定義</em>になることがあります。
	</p>
	
	<p>入れ子のコレクションは、式内で上よりもさらに高いレベルの「ドット」構文を使用して参照できます。<i>例：</i>「Person」というステージに、「Type」、「Name」、「Grade」という3つのフィールドを持つ「Qualifications」というコレクションがある場合、これらのフィールドには、参照 <code>[Person.Qualifications.Type]</code>、<code>[Person.Qualifications.Name]</code>、<code>[Person.Qualifications.Grade]</code>を使用してアクセスできます。</p>
	
	<p>同様に、<a href="frmStagePropertiesLoopStage.htm">ループの開始</a>ステージでは、同じ構文を使用して入れ子のコレクションを直接ループできます。そのため、上の例の個人の資格をループするには、ループの開始ステージでコレクションを<code>Person.Qualifications</code>に設定します。これは通常、<code>Person</code>コレクションを反復処理するループステージ内でのみ意味があります。
	</p>
	
	<p>ただし、内部コレクションビジネスオブジェクトは、入れ子のコレクションをサポートしません。内部アクションで参照する前に、まず入れ子のコレクションをコレクションステージに移動する必要があります。</p>

	<h3>現在の行</h3>
	<p>コレクションの行へのアクセスは、ループステージを使用して行う必要があります。ループステージは、コレクションの現在の行を自動的に更新し、ある行から次の行に順番に移動します。この変更は、<a href="frmStagePropertiesLoopEnd.htm">ループの終了</a>ステージに達するたびに発生します。ループステージに入る前に、コレクションは最初の行になります。ループステージは、コレクションの最後の行に到達するまで行を反復します。この時点でループは終了し、現在の行はなくなります。現在の行がないときにコレクションにアクセスしようとするとエラーになります。データに再度アクセスするには、何らかのアクションを実行して「現在の行」をもう一度設定する必要があります。該当するアクションの例として以下があります。</p>
	<ul>
		<li>新しいループに入る。</li>
		<li>新しい行をコレクションに追加する（これが現在の行になり、データの入力準備が整います）。</li>
	</ul>
	
	<h3>コレクションを操作する</h3>
	<p>コレクションは、「Internal - Collections」ビジネスオブジェクトを使用して操作できます。内部ビジネスオブジェクトの詳細については、「<a href="helpInternalBusinessObjects.htm">内部ビジネスオブジェクトの概要</a>」を参照してください。以下のアクションでは、必ず入力パラメーターとしてコレクションの名前を指定する必要があります。この名前は、コレクション型ではなくキスト<a href="helpDataTypes.htm">データ型</a>テキストです。名前付きのコレクションを使用するには、そのコレクションにアクセスできなければなりません（つまり、別のページにあったり、非表示になっていたリしてはなりません）。</p>

	<dl class="bulleted">
		<dt>行を追加</dt>
		<dd>このアクションは、コレクションに新しい行を追加します。新しい行が現在の行になり、新しいデータを入力できるようになります。</dd>

		<dt>行を削除</dt>
		<dd>このアクションは、現在の行をコレクションから削除します。行が削除されると、現在の行はなくなります。
		</dd>
		<dd>ループの反復処理中に行が削除された場合、ループはループの終了ステージに到達したときに（本来進むはずであった行の）次の行に進みます。その間に現在の行にアクセスしようとすると、エラーが発生します。</dd>

		<dt>すべての行を削除</dt>
		<dd>このアクションは、コレクションからすべての行を削除します。行が削除されると、現在の行はなくなります。
		</dd>
		<dd>ループの反復処理中にすべての行が削除された場合、ループの終了ステージに達したときにループが新しい行に進むことはありません。その間に現在の行にアクセスしようとすると、エラーが発生します。</dd>
		
		<dt>行をカウント</dt>
		<dd>このアクションは、コレクション内の行数を取得します。このアクションは、行数を取得するためにデータアイテムにマップする必要がある「count」という追加の出力パラメーターを持つという点で他の2つのアクションとは異なります。</dd>
	</dl>
	
	<h3 id="singlerow">単一行コレクション</h3>
	<p>「単一行」コレクションには常に1つの行があり、その行は自動的に現在の行として設定されます。コレクションビジネスオブジェクトの行操作アクションが単一行コレクションで呼び出されると、エラーが発生します。この場合、<code>カウント行</code>は常に<i>1</i>を返します。
	
	<h2>例</h2>

	<h3>未定義のコレクション</h3>
	<div class="section-indent">
		<p>Microsoft Excelワークシートのコンテンツ全体を取得するとします。</p>

		<ol class="headed">
			
			<li><h4>準備</h4>
			<p>CommonAutomationビジネスオブジェクトの<em class="buzzword">CommonAutomation.clsExcel</em>がインストールされていることを確認したら、<a href="frmProcess.htm">プロセススタジオ</a>を開き、以下のステージを追加します。</p>
			<ul>
				<li>コレクションステージ - これはデータを入力するコレクションです。</li>

				<li>2つのアクションステージ - 議論の対象になるのはこれらのうちの一方だけです。もう一方は実際に必要なステージです。</li>
			</ul>
			</li>
			
			<li><h4>データを取得するアクションを構成する</h4>
			<p>アクションステージを使用してコレクションにデータを入力する必要があります。
 2つのアクションステージのうちの2番目のプロパティページを開きます。ドロップダウンメニューからビジネスオブジェクトとして［Microsoft Office - Excelアクション］を選択します（これが表示されない場合、ビジネスオブジェクトは正常にインストールされていません）。アクションとして［ワークシートをコレクションとして取得］を選択します。出力タブで、コレクションステージの名前を「Col1」という出力にドラッグアンドドロップします。これは、選択したコレクションに収集したデータを配置するようアクションに指示します。</p>
			</li>
			
			<li><h4>前提条件に対処する</h4>

			<p>プロセスが機能する前に、アクションステージで指定されたすべての前提条件を満たす必要があります。現在のアクションプロパティの前提条件タブに「ワークブックがアクティブである必要があります」と表示されていることを確認します。これがその他のアクションステージの理由です。そのアクションステージのプロパティを開き、ビジネスオブジェクト「Microsoft Office - Excelアクション」からアクション［ワークブックを開く］を選択します。
 既存のMicrosoft Excelワークブックのパスを入力します。</p>
			</li>
			
			<li><h4>完了する</h4>

			<p>最後に、リンクを使用してアクションステージを参加させます（コレクションステージを何かに参加させる必要はありません）。プロセスを実行すると、2番目のステージが実行された後にコレクションにデータが入力されます。</p>
			</li>
			
		</ol>
	</div>

	<h3>定義済みのコレクション</h3>
	<div class="section-indent">
		<p>変更されないフィールドヘッダーを持つテーブルのコンテンツ全体を取得するとします。</p>

		<ol class="headed">
		
			<li><h4>準備</h4>

			<p>コレクションを返すビジネスオブジェクトが使用可能であることを確認したら、<a href="frmProcess.htm">プロセススタジオ</a>を開き、以下のステージを追加します。</p>
			<ul>
				<li>コレクションステージ - これはデータを入力するコレクションです。</li>
				<li>1つのアクションステージ - これはコレクションにデータを入力するステージです。</li>
			</ul></li>
		
			<li><h4>コレクションを定義する</h4>

			<p>コレクションステージのプロパティを開きます。［フィールド］タブで［フィールドを追加］ボタンをクリックし、データを入力するコレクションのフィールドと完全に一致するフィールドを追加します。コレクション内の各フィールドのデータ型も選択します。これらもデータを入力するコレクションと完全に一致する必要があります。</p></li>

			<li><h4>データを取得するアクションを構成する</h4>

			<p>アクションステージを使用してコレクションにデータを入力する必要があります。
 アクションステージの［プロパティ］ページを開きます。コレクションを返すビジネスオブジェクトアクションを選択し、［出力］タブでその出力を「Coll1」というコレクションステージに設定します。</p></li>

			<li><h4>完了する</h4>

			<p>最後に、リンクを使用してアクションステージを参加させます（コレクションステージを何かに参加させる必要はありません）。プロセスを実行すると、アクションステージ以降にコレクションにデータが入力されます。</p></li>
		</ol>
	</div>
</body>
</html>
