<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<link type="text/css" href="AutomateHelp.css" rel="stylesheet"/>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<title>アクティブキュー</title>
	<script type="text/javascript" src="script/imagezoom.js"></script>
	<style type="text/css">
	</style>
</head>

<body class="slick">
	<div class="header">
		<h1 class="pagetitle">プロセス機能</h1>
		<h2>アクティブキュー</h2>
	</div>

	<div class="captioned-image overview-screenshot nozoom">
		<a href="Graphics/active-queues.png" title="アクティブキュー - クリックして拡大画像を表示"><img alt="アクティブキュー - クリックして拡大画像を表示" src="Graphics/active-queues.png"/></a>
		<p>アクティブキュー</p>
	</div>

	<h3 id="overview">概要</h3>

    <p>Blue Prism製品には、セッション内でキューに入れ、事前定義された順序で作業できるようにするための<a href="helpQueues.htm">ワークキュー</a>があります。</p>

    <p>セッションは、従来のセッション管理モデルを使用し、処理を行うケースについてワークキューにポーリングを行うリソースで開始します。これらのセッションは、コントロールルームで手動により開始するか、<a href="helpScheduler.htm">Blue Prismサーバー</a>インスタンスで実行する<a href="helpBPServer.htm">スケジューラー</a>サービスで開始します。</p>

    <p>アクティブキューは、キューを処理するセッションを管理する代替メカニズムを導入します。これはワークキューとセッション間の密接な関連付けを作成することにより実現されます。</p>

    <p>コントロールルームでセッションを個別に作成し、キュー管理ページを開いて結果を確認する代わりに、アクティブキューではキューを処理するリソースの目標数を設定できます。Blue Prismでは、アクティブキューの構成を使用して、その目標を達成する方法を決定します。</p>

    <h3 id="queue-requirements">アクティブキューの要件</h3>

    <p>Blue Prismがキューに代わってセッションを開始および停止する方法を決定するには、キューについて以下の点を把握しておく必要があります。</p>

    <ul>
      <li>キューを処理するプロセス</li>
      <li>キューの処理に使用するリソース</li>
    </ul>

    <p>この情報は、Blue Prismクライアントの［<a href="sysman-queues.html">システム</a>］セクションの［<code>ワークキューの構成</code>］ページで、パブリッシュされたプロセスと、キューを持つリソースグループを関連付けて設定されます。</p>

    <p>Blue Prismは、この情報を基に利用可能なリソースを探し、そこにプロセスを作成します。キューはそこで処理されます。</p>

    <p>実行されているセッションをアクティブキューに代わって停止するには、セッションに対して「停止リクエスト」を送ります。そうすると、処理の途中で停止されなくなります。詳細については、「<a href="#process-requirements">プロセスの要件</a>」を参照してください。</p>

    <h3 id="process-requirements">プロセスの要件</h3>

    <p>アクティブキューに代わって実行するプロセスは、いくつかの基本的な要件を満たす必要があります。</p>

    <ul>
      <li>アクティブキューで割り当てられたプロセスとして設定するには、プロセスをパブリッシュする必要があります。</li>

      <li><p>プロセスにメインループが含まれていることを想定し、ループ内の決定ステージを使用して<code>IsStopRequested()</code>関数をクエリし、安全な停止をリクエストする必要があります。</p>
          <p>これは、アクティブキューのコントローラーが、管理対象のアクティブキューに代わって実行しているセッションを停止するためのしくみです。</p></li>
    </ul>

     <h3 id="how-it-works">しくみ</h3>
     <p>コントロールルームの［<code>アクティブキュー</code>］セクションに入ると、表示されているキューごとに<code>アクティブキューコントローラー</code>が作成されます。これらのコントローラーは、ユーザーがクライアントからログアウトするまでメモリ内に残ります。</p>

     <p>各コントローラーは、キューに割り当てられているリソースで実行されているセッションを監視し、担当するキューの最新統計のデータベースをポーリングします。</p>

     <p>ターゲットリソース値が設定されると、コントローラーはそのターゲットに到達するために新しいセッションを作成する必要があるかどうか、既存のセッションを停止する必要があるかどうかを判断します。新しいセッションが必要な場合は、新しいセッションを作成して開始します。既存のセッションを停止する必要がある場合は、目標値に達するための適切なセッション数まで停止リクエストを送信します。</p>

     <h4>新しいセッションの作成</h4>
     <p>ターゲットに到達するために新しいセッションを作成する必要があるとキューコントローラーが判断した場合、キューコントローラーは、そのキューに割り当てられているリソースグループ内の利用可能なリソースで新しいセッションを作成して開始します。</p>

     <p>たとえば、最も使用率の低いリソースでセッションを作成します。
 グループに3つの利用可能なリソースがあり、そのうちの2つがバックグラウンドプロセスを実行している場合、最初に作成したセッションは、いずれのセッションも実行していないリソース上にあります。</p>

     <p>何らかの理由でセッションの作成または開始に失敗した場合は、他のリソースで再試行されます。3回試行した後、セッションを中止し、セッションの作成が試行されなくなることを示すためにターゲット値を減らします。</p>

     <p>セッションがコントローラーによって中止される原因となるエラーが発生した場合、エラーはBlue Prismイベントログに記録され、Windowsイベントビューアーを使用して表示されます。</p>

     <h4>既存セッションの停止</h4>
     <p>ターゲットに到達するためには、既存のセッションを停止する必要があることをキューコントローラーが決定した場合、セッションを反復させて、最も古いセッション（つまり、一番早く開始したセッション）を選択し、停止リクエストを送信します。</p>

     <p>コントローラーがセッションに停止リクエストを送信すると、セッションは「<code>停止中</code>」としてマークされます。この状態ではまだ「実行中」です。つまり、キューの「アクティブセッション」数にカウントされ、それ以降のセッションを実行できません。</p>

     <p>正常に停止するには、作業者は<code>IsStopRequested()</code>関数を定期的にチェックする必要があります。停止がリクエストされていることを関数が示す場合、環境をクリーンアップし、プロセスを終了します。</p>

     <h4>セッションの完了または終了</h4>
     <p>アクティブキューに代わって実行されているセッションが完了または終了すると、そのキューの「アクティブセッション」数から除外され、それ以降のセッションで再び利用可能になります。</p>

     <p>停止リクエストがキューコントローラーによって送信された後に完了や終了が発生した場合、ターゲットリソース値は変更されません（つまり、目標値に達するためにセッションが停止することを想定）。</p>

     <p>停止リクエストがキューコントローラーによって送信される前に完了/終了が発生した場合、ターゲットリソースの値は減少します。それに代わる他のセッションは作成されません。</p>

     <h3 id="pools">アクティブキューとリソースプール</h3>

     <p>ある程度まで、<a href="helpResourcePools.htm">リソースプール</a>は、アクティブキュー内の割り当てられたリソースグループと同じ問題を解決しようとします。つまり、利用可能なリソースを探し、そこでプロセスを実行しようとします。</p>

     <p>そのため、アクティブキュー内でリソースプールを使用することはお勧めしません。アクティブキューコントローラーは、各リソースがそのキューに代わってセッションを実行するための単一のスロットを表すことを想定しています。リソースプールは、複数の排他セッションを実行できる単一のリソースのように見えるという点で透過的であり、キューコントローラーは、利用可能かどうかを確認するためにメンバーリソースにドリルダウンできません。</p>

     <p>リソースプールをアクティブキューに割り当てられたリソースグループに含めると、そのリソースプールは「利用可能なリソース」カウントで単一のリソースとして扱われ、単一のセッションのみが割り当てられます。</p>


</body>
</html>
